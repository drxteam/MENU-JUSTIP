<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Menu Jastip</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* CSS AGAR TAMPILAN RAPI */
        body {
            font-family: sans-serif;
            background-color: #f5f5f5; /* Warna abu muda */
            margin: 0; padding: 0;
            padding-bottom: 100px;
        }
        
        .header {
            background-color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 10;
        }
        .header h2 { margin: 0; color: #333; }
        .header p { margin: 5px 0 0; color: #666; font-size: 14px; }
        
        .container {
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2 Kolom */
            gap: 15px;
        }

        .card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex; flex-direction: column;
        }

        .card img {
            width: 100%; height: 120px; object-fit: cover;
            background-color: #ddd;
        }

        .details { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; }
        .name { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .price { color: #27ae60; font-weight: bold; font-size: 14px; margin-bottom: 10px; }

        .btn-add {
            margin-top: auto;
            background: #3498db; color: white;
            border: none; padding: 8px; border-radius: 5px;
            width: 100%; font-weight: bold; cursor: pointer;
        }
        .btn-add:active { background: #2980b9; }

        /* Floating Cart */
        .cart-bar {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            background-color: #e67e22; color: white;
            padding: 15px; border-radius: 50px;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: bold; cursor: pointer;
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4);
            display: none; /* Hidden default */
        }
    </style>
</head>
<body>

    <div class="header">
        <h2>MENU JUSTIP</h2>
        <p>Kloter Siang (Tutup 11.00)</p>
    </div>

    <div class="container" id="menu-list"></div>

    <div class="cart-bar" id="checkout-btn" onclick="checkout()">
        <span id="cart-info">0 Item</span>
        <span>Lanjut Pesan ‚ûù</span>
    </div>

    <script>
        // --- DATA MENU DUMMY ---
        const menus = [
            { id: 1, name: "Nasi Goreng Mawut", price: 15000, img: "https://via.placeholder.com/300/ff7f50/ffffff?text=Nasgor" },
            { id: 2, name: "Ayam Geprek", price: 18000, img: "https://via.placeholder.com/300/2ecc71/ffffff?text=Geprek" },
            { id: 3, name: "Es Teh Jumbo", price: 5000, img: "https://via.placeholder.com/300/3498db/ffffff?text=Es+Teh" },
            { id: 4, name: "Tahu Walik", price: 10000, img: "https://via.placeholder.com/300/9b59b6/ffffff?text=Tahu" }
        ];

        let cart = {};

        // --- FUNGSI RENDER (MENAMPILKAN MENU) ---
        function renderMenu() {
            const el = document.getElementById('menu-list');
            el.innerHTML = ""; // Bersihkan dulu
            
            menus.forEach(item => {
                let qty = cart[item.id] || 0;
                let btnText = qty > 0 ? `${qty}x (Klik utk tambah)` : "Tambah +";
                let btnColor = qty > 0 ? "#27ae60" : "#3498db";

                el.innerHTML += `
                <div class="card">
                    <img src="${item.img}" alt="${item.name}">
                    <div class="details">
                        <div class="name">${item.name}</div>
                        <div class="price">Rp ${item.price.toLocaleString()}</div>
                        <button class="btn-add" style="background:${btnColor}" onclick="addToCart(${item.id})">
                            ${btnText}
                        </button>
                    </div>
                </div>`;
            });
        }

        // --- LOGIC KERANJANG ---
        function addToCart(id) {
            if (!cart[id]) cart[id] = 0;
            cart[id]++;
            renderMenu(); // Re-render untuk update tombol
            updateCartBar();
        }

        function updateCartBar() {
            let totalItem = 0;
            let totalPrice = 0;
            for(let id in cart) {
                let item = menus.find(x => x.id == id);
                totalItem += cart[id];
                totalPrice += item.price * cart[id];
            }

            const btn = document.getElementById('checkout-btn');
            if (totalItem > 0) {
                btn.style.display = "flex";
                document.getElementById('cart-info').innerText = `${totalItem} Item - Rp ${totalPrice.toLocaleString()}`;
            } else {
                btn.style.display = "none";
            }
        }

        // --- FUNGSI CHECKOUT (AMAN UNTUK CHROME & TELEGRAM) ---
        function checkout() {
            let data = { type: "order", cart: cart };
            
            // Cek apakah di dalam Telegram?
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initData) {
                window.Telegram.WebApp.sendData(JSON.stringify(data));
            } else {
                // Jika di Chrome biasa, munculkan alert saja
                alert("Data JSON yang akan dikirim ke Bot:\n" + JSON.stringify(data));
            }
        }

        // Jalankan render pertama kali
        renderMenu();

        // Coba expand Telegram (pakai Try-Catch agar tidak error di Chrome)
        try {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.expand();
            }
        } catch (e) {
            console.log("Bukan di Telegram, mode browser aktif.");
        }
    </script>
</body>
</html>
